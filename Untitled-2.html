<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBVA - Espace Client Fictif</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuration de la police Inter */
        html { font-family: 'Inter', sans-serif; }
    </style>
    <script>
        // Configuration Tailwind pour le thème Bleu Marin et Blanc
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#052a5c', /* Bleu Marin profond (similaire BBVA) */
                        'secondary': '#2e74c9', /* Bleu Clair (action/boutons) */
                        'success': '#10b981', /* Vert */
                        'failure': '#ef4444', /* Rouge */
                        'bbva-bg': '#003153', /* Couleur de fond pour l'en-tête */
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8 flex justify-center items-center">

    <!-- Écran de Connexion -->
    <div id="login-screen" class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl border-t-4 border-primary">
        <h1 class="text-3xl font-bold text-center text-primary mb-6 flex items-center justify-center">
            <svg class="w-8 h-8 mr-3 text-primary" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15H9v-2h2v2zm0-4H9v-4h2v4zm7 0h-2v4h2v-4zM6 9h2v4H6V9z"/></svg>
            BBVA - Connexion
        </h1>
        <p class="text-center text-gray-500 mb-6">Veuillez vous identifier pour accéder à votre compte.</p>

        <div class="space-y-4">
            <div>
                <label for="login-username" class="block text-sm font-medium text-gray-700">Identifiant (login)</label>
                <!-- Valeur par défaut visible -->
                <input type="text" id="login-username" value="Alba-perez" placeholder="Alba-perez"
                       class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-secondary focus:border-secondary transition font-mono bg-gray-50" />
            </div>
            <div>
                <label for="login-password" class="block text-sm font-medium text-gray-700">Mot de passe</label>
                <!-- Valeur par défaut visible (texte, non masqué pour info) -->
                <input type="text" id="login-password" value="Eureka25@" placeholder="Eureka25@"
                       class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-secondary focus:border-secondary transition font-mono bg-gray-50" />
            </div>
            <button onclick="handleLogin()" 
                    class="w-full bg-primary hover:bg-secondary text-white font-bold py-3 rounded-lg transition duration-150 shadow-md">
                Se Connecter
            </button>
        </div>
        <p id="login-error" class="text-red-500 text-center mt-4 hidden">Identifiant ou mot de passe incorrect.</p>
    </div>

    <!-- Conteneur Principal de l'Application Bancaire (Initialement caché) -->
    <div id="main-app" class="w-full max-w-5xl hidden">
        
        <!-- En-tête -->
        <header class="bg-bbva-bg p-6 rounded-t-xl shadow-lg border-t-4 border-primary text-white">
            <div class="flex justify-between items-start flex-wrap">
                <h1 class="text-3xl font-bold flex items-center">
                    <svg class="w-8 h-8 mr-3 text-secondary" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9 17v-2h2v2H9zm0-4v-4h2v4H9zm7 0h-2v4h2v-4zM6 9h2v4H6V9z"/></svg>
                    BBVA - Espace Client
                </h1>
                <div class="text-right mt-2 sm:mt-0">
                    <p class="text-sm text-gray-300">Bienvenue <span id="holder-name" class="font-semibold"></span></p>
                    <p id="current-date" class="text-sm font-medium"></p>
                </div>
            </div>
        </header>

        <!-- Conteneur du Compte -->
        <main class="bg-white p-6 sm:p-8 rounded-b-xl shadow-lg mb-8">
            
            <!-- Détails des Comptes & Soldes -->
            <section class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-6 border-b pb-6">
                
                <!-- Solde Courant -->
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 border-primary shadow-sm">
                    <h2 class="text-xl font-semibold text-gray-700 mb-1">Compte Courant</h2>
                    <p class="text-sm text-gray-500 mb-3">IBAN <span id="account-number" class="font-mono text-xs"></span></p>
                    <p class="text-sm text-gray-500">Solde Actuel</p>
                    <p id="current-balance" class="text-3xl font-extrabold text-primary"></p>
                </div>

                <!-- Solde Épargne -->
                <div class="bg-gray-50 p-5 rounded-lg border-l-4 border-success shadow-sm">
                    <h2 class="text-xl font-semibold text-gray-700 mb-1">Compte Épargne</h2>
                    <p class="text-sm text-gray-500 mb-3">Taux annuel : 2.5%</p>
                    <p class="text-sm text-gray-500">Montant Épargné</p>
                    <p id="savings-balance" class="text-3xl font-extrabold text-success"></p>
                </div>
                
                <!-- Options Rapides / Virement -->
                <div class="p-5 flex flex-col justify-end">
                    <button onclick="showTransferModal()" 
                            class="w-full bg-secondary hover:bg-primary text-white font-bold py-3 px-4 rounded-lg transition duration-150 shadow-md">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
                        Virement
                    </button>
                </div>
            </section>

            <!-- Section des Transactions (Dépôt et Retrait) -->
            <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                
                <!-- Dépôt -->
                <div class="bg-green-50 p-6 rounded-lg shadow-sm border border-green-200">
                    <h3 class="text-xl font-semibold text-green-700 mb-4">Déposer (sur Courant)</h3>
                    <div class="flex gap-3">
                        <input type="number" id="deposit-amount" min="1" value="100" placeholder="Montant du dépôt"
                               class="flex-grow p-2 border border-green-300 rounded-lg focus:ring-green-500 focus:border-green-500" />
                        <button onclick="handleTransaction('deposit')" 
                                class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            Déposer
                        </button>
                    </div>
                </div>

                <!-- Retrait -->
                <div class="bg-red-50 p-6 rounded-lg shadow-sm border border-red-200">
                    <h3 class="text-xl font-semibold text-red-700 mb-4">Retirer (du Courant)</h3>
                    <div class="flex gap-3">
                        <input type="number" id="withdrawal-amount" min="1" value="50" placeholder="Montant du retrait"
                               class="flex-grow p-2 border border-red-300 rounded-lg focus:ring-red-500 focus:border-red-500" />
                        <button onclick="handleTransaction('withdrawal')" 
                                class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            Retirer
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Message de notification (Alert) -->
            <div id="notification-area" class="mb-6 p-3 rounded-lg text-white font-medium hidden" role="alert"></div>

            <!-- Historique des Transactions -->
            <section>
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Historique du Compte Courant</h2>
                
                <div class="overflow-x-auto bg-gray-50 rounded-lg shadow-inner">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Nouveau Solde</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-history" class="bg-white divide-y divide-gray-200">
                            <!-- Les transactions seront insérées ici par JS -->
                        </tbody>
                    </table>
                </div>
                
                <p id="empty-history" class="text-center text-gray-500 py-6 hidden">
                    Aucune transaction enregistrée pour l'instant.
                </p>
            </section>

        </main>
        
        <!-- Pied de page/Informations techniques -->
        <footer class="text-center text-xs text-gray-400 mt-4">
            Prototype BBVA fictif développé en HTML, Tailwind CSS et JavaScript.
        </footer>
    </div>
    
    <!-- Modal de Virement (caché) -->
    <div id="transfer-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden flex justify-center items-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg transform transition-all">
            <h3 class="text-2xl font-bold text-primary mb-4">Effectuer un Virement</h3>
            
            <div class="space-y-4">
                <div>
                    <label for="transfer-beneficiary" class="block text-sm font-medium text-gray-700">Nom du Bénéficiaire</label>
                    <input type="text" id="transfer-beneficiary" value="Autre Banque S.A."
                           class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" />
                </div>
                <div>
                    <label for="transfer-iban" class="block text-sm font-medium text-gray-700">IBAN du Bénéficiaire</label>
                    <!-- IBAN Fictif Espagnol (ES) -->
                    <input type="text" id="transfer-iban" value="ES9100810146910001234567"
                           class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" />
                </div>
                <div>
                    <label for="transfer-amount" class="block text-sm font-medium text-gray-700">Montant (€)</label>
                    <input type="number" id="transfer-amount" min="1" value="1000"
                           class="mt-1 block w-full p-3 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary" />
                </div>
            </div>

            <div class="flex justify-end space-x-4 mt-6">
                <button onclick="closeTransferModal()" 
                        class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">
                    Annuler
                </button>
                <button onclick="attemptTransfer()" 
                        class="px-4 py-2 bg-secondary hover:bg-primary text-white font-bold rounded-lg transition">
                    Valider le Virement
                </button>
            </div>
            
        </div>
    </div>


    <!-- Logique JavaScript -->
    <script>
        // --- CONFIGURATION ET AUTHENTIFICATION ---
        
        // Identifiants requis par l'utilisateur
        const REQUIRED_LOGIN = "Alba-perez";
        const REQUIRED_PASSWORD = "Eureka25@";
        
        // Fonction utilitaire pour générer un IBAN espagnol fictif (ES + 22 chiffres)
        function generateSpanishIban() {
            let digits = '0081'; // Code bancaire BBVA fictif
            for (let i = 0; i < 18; i++) {
                digits += Math.floor(Math.random() * 10);
            }
            return `ES${digits}`;
        }

        // État initial du compte (simule la base de données)
        const accountState = {
            accountNumber: generateSpanishIban(), // IBAN espagnol généré ici
            holderName: "Alba Perez",
            balance: 150875.00, // Solde courant initial (150875 EUR)
            savings: 70800.00,  // Solde épargne initial (70800 EUR)
            transactions: []
        };

        const notificationArea = document.getElementById('notification-area');
        
        // Fonction d'authentification
        function handleLogin() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error');

            if (username === REQUIRED_LOGIN && password === REQUIRED_PASSWORD) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                errorElement.classList.add('hidden');
                updateUI(); // Charger l'interface principale après la connexion
            } else {
                errorElement.classList.remove('hidden');
                errorElement.textContent = "Identifiant ou mot de passe incorrect. Veuillez réessayer.";
            }
        }

        // --- GESTION DE L'INTERFACE ET DES NOTIFICATIONS ---

        // Fonction pour afficher une notification temporaire
        function showNotification(message, type = 'success') {
            let bgColor;
            if (type === 'success') {
                bgColor = 'bg-success';
            } else if (type === 'error') {
                bgColor = 'bg-failure';
            } else {
                bgColor = 'bg-secondary';
            }

            notificationArea.className = `mb-6 p-3 rounded-lg text-white font-medium ${bgColor}`;
            notificationArea.textContent = message;
            notificationArea.classList.remove('hidden');

            // Masque la notification après 4 secondes
            setTimeout(() => {
                notificationArea.classList.add('hidden');
            }, 4000);
        }

        // Met à jour l'interface utilisateur avec l'état actuel
        function updateUI() {
            // Formatage du solde en EUR
            const formatter = new Intl.NumberFormat('fr-FR', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 2,
            });

            // Mise à jour des informations de compte
            document.getElementById('holder-name').textContent = accountState.holderName;
            document.getElementById('account-number').textContent = accountState.accountNumber;
            document.getElementById('current-balance').textContent = formatter.format(accountState.balance);
            document.getElementById('savings-balance').textContent = formatter.format(accountState.savings);
            
            // Mise à jour de la date du jour
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('fr-FR', dateOptions);

            // Mise à jour de l'historique
            const historyBody = document.getElementById('transaction-history');
            historyBody.innerHTML = ''; // Vide l'historique précédent

            if (accountState.transactions.length === 0) {
                document.getElementById('empty-history').classList.remove('hidden');
                return;
            } else {
                document.getElementById('empty-history').classList.add('hidden');
            }

            // Affiche les transactions les plus récentes en premier
            accountState.transactions.slice().reverse().forEach(tx => {
                const isDeposit = tx.type.includes('Dépôt');
                const isFailedTransfer = tx.type.includes('Échoué');
                
                let amountClass;
                let typeBg;

                if (isFailedTransfer) {
                    amountClass = 'text-gray-500 font-semibold line-through';
                    typeBg = 'bg-gray-200 text-gray-700';
                } else if (isDeposit) {
                    amountClass = 'text-green-600 font-semibold';
                    typeBg = 'bg-green-100 text-green-700';
                } else {
                    amountClass = 'text-red-600 font-semibold';
                    typeBg = 'bg-red-100 text-red-700';
                }

                const row = historyBody.insertRow();
                row.className = 'hover:bg-gray-50';

                // Date
                row.insertCell(0).textContent = new Date(tx.date).toLocaleTimeString('fr-FR', {
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });
                
                // Type
                const typeCell = row.insertCell(1);
                typeCell.innerHTML = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${typeBg}">${tx.type}</span>`;
                
                // Montant
                const amountCell = row.insertCell(2);
                amountCell.className = `px-6 py-4 whitespace-nowrap text-sm ${amountClass}`;
                
                // Si c'est un retrait ou une tentative de virement (montant négatif dans l'objet)
                let displayAmount = Math.abs(tx.amount);
                let sign = (tx.amount > 0 && isDeposit) ? '+' : '-';

                amountCell.textContent = sign + formatter.format(displayAmount).replace('€', ''); 
                
                // Nouveau Solde
                const balanceCell = row.insertCell(3);
                balanceCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right';
                balanceCell.textContent = isFailedTransfer ? 'N/A' : formatter.format(tx.newBalance);
            });
        }

        // --- LOGIQUE DES TRANSACTIONS COURANTES (DÉPÔT / RETRAIT) ---

        // Fonction pour gérer les dépôts et les retraits (sur le compte courant uniquement)
        function handleTransaction(type) {
            let amountElement;
            let transactionTypeLabel;
            
            if (type === 'deposit') {
                amountElement = document.getElementById('deposit-amount');
                transactionTypeLabel = 'Dépôt';
            } else if (type === 'withdrawal') {
                amountElement = document.getElementById('withdrawal-amount');
                transactionTypeLabel = 'Retrait';
            } else {
                return; // Type invalide
            }

            const amount = parseFloat(amountElement.value);

            if (isNaN(amount) || amount <= 0) {
                showNotification("Veuillez entrer un montant valide supérieur à 0.", 'error');
                return;
            }

            let newBalance = accountState.balance;

            if (type === 'withdrawal') {
                if (amount > newBalance) {
                    showNotification("Fonds insuffisants. Opération annulée.", 'error');
                    return;
                }
                newBalance -= amount;
                amountElement.value = 50;
            } else if (type === 'deposit') {
                newBalance += amount;
                amountElement.value = 100;
            }
            
            // Mise à jour de l'état
            accountState.balance = newBalance;
            const transaction = {
                date: new Date().toISOString(),
                type: transactionTypeLabel,
                amount: amount,
                newBalance: newBalance
            };
            accountState.transactions.push(transaction);

            // Mettre à jour l'interface
            updateUI();
            showNotification(`${transactionTypeLabel} de ${amount.toFixed(2)} € effectué avec succès !`, 'success');
        }

        // --- LOGIQUE DU VIREMENT (AVEC ÉCHEC SPÉCIFIQUE) ---

        function showTransferModal() {
            document.getElementById('transfer-modal').classList.remove('hidden');
        }

        function closeTransferModal() {
            document.getElementById('transfer-modal').classList.add('hidden');
        }

        function attemptTransfer() {
            const amount = document.getElementById('transfer-amount').value;
            const beneficiary = document.getElementById('transfer-beneficiary').value;

            // Masquer le modal immédiatement
            closeTransferModal();

            // Logique d'échec spécifique demandée par l'utilisateur
            const errorMessage = "Alerte Compte : Le virement en ligne demandé n'a pas pu aboutir. Vous avez dépassé la limite autorisée pour les virements ce mois-ci. Il sera renouveler dans 30 jours.";
            
            showNotification(errorMessage, 'error');

            // Ajouter l'échec à l'historique pour simuler une tentative
            // Le montant sera négatif dans l'objet transaction, mais le solde reste inchangé (pas de newBalance)
            const transaction = {
                date: new Date().toISOString(),
                type: `Virement Échoué (à ${beneficiary})`,
                amount: parseFloat(amount) * -1, 
                newBalance: accountState.balance // Le solde n'a pas changé
            };
            accountState.transactions.push(transaction);
            updateUI();
        }


        // --- EXÉCUTION À L'INITIALISATION DE LA PAGE ---

        window.onload = function() {
            
            // Simuler des transactions initiales pour le compte courant (pour l'historique)
            accountState.transactions.push({
                date: new Date(Date.now() - 86400000).toISOString(), // Il y a 1 jour
                type: "Dépôt",
                amount: 5000.00,
                newBalance: accountState.balance - 5000.00 // Fictif, juste pour l'historique
            });
            accountState.transactions.push({
                date: new Date(Date.now() - 3600000).toISOString(), // Il y a 1 heure
                type: "Retrait",
                amount: 1500.00,
                newBalance: accountState.balance // Fictif, juste pour l'historique
            });
            
            // Le solde final dans l'état doit être le solde initial demandé
            accountState.balance = 150875.00;
            
            // Mise à jour visuelle du compte client et solde
            document.getElementById('holder-name').textContent = accountState.holderName;
        };

    </script>
</body>
</html>